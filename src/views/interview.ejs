<div class="min-h-screen bg-gradient-to-br from-slate-50 to-blue-50/30 py-10">
  <div class="max-w-2xl mx-auto px-4 sm:px-6 lg:px-8">

    <!-- Header -->
    <div class="text-center mb-10">
      <h1 class="text-4xl font-extrabold text-slate-900 mb-3">Generate Interview Questions</h1>
      <p class="text-slate-600 text-lg">AI-generated questions tailored to role, skills & experience</p>
    </div>

    <!-- Form Card -->
    <div class="bg-white rounded-2xl shadow-xl border border-slate-200 p-8">
      <form id="genForm" class="space-y-7">

        <!-- Job Title -->
        <div>
          <label class="block text-sm font-semibold text-slate-800 mb-2">Job Title</label>
          <input
            id="title"
            type="text"
            required
            placeholder="e.g., SDE, Frontend Developer, Cloud Engineer"
            class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
          />
        </div>

        <!-- Interview Type -->
        <div>
          <label class="block text-sm font-semibold text-slate-800 mb-2">Interview Type</label>
          <select
            id="type"
            class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-primary-500"
          >
            <option value="Technical" selected>Technical</option>
            <option value="System Design">System Design</option>
            <option value="Behavioral">Behavioral</option>
            <option value="HR Round">HR Round</option>
          </select>
        </div>

        <!-- Skills Tag Input -->
        <div>
          <label class="block text-sm font-semibold text-slate-800 mb-2">Skills (type & press Enter)</label>
          
          <!-- Input -->
          <input
            id="skillInput"
            type="text"
            placeholder="e.g., Java, DSA, React, System Design..."
            class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-primary-500 placeholder-slate-400"
          />

          <!-- Tag container -->
          <div id="skillTags" class="flex flex-wrap gap-2 mt-3"></div>

          <p class="text-xs text-slate-500 mt-2">Example: Java, SQL, AWS, React, DevOps</p>
        </div>

        <!-- Experience Level -->
        <div>
          <label class="block text-sm font-semibold text-slate-800 mb-2">Experience Level</label>
          <select
            id="experienceLevel"
            class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-primary-500"
          >
            <option value="Junior">Junior (0–1 yrs)</option>
            <option value="Mid" selected>Mid (2–5 yrs)</option>
            <option value="Senior">Senior (5+ yrs)</option>
          </select>
        </div>

        <!-- Duration -->
        <div>
          <label class="block text-sm font-semibold text-slate-800 mb-2">Interview Duration (minutes)</label>
          <input
            id="duration"
            type="number"
            min="5"
            max="120"
            value="20"
            class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-primary-500"
          />
        </div>

        <!-- Submit Button -->
        <button 
          id="genBtn" 
          type="submit"
          class="w-full bg-gradient-to-r from-primary-600 to-blue-600 text-white py-4 px-6 rounded-xl font-bold shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-200"
        >
          Generate Interview Questions
        </button>

        <!-- Loading -->
        <div id="loadingState" class="hidden text-center py-4">
          <div class="flex items-center justify-center space-x-3 text-primary-600">
            <div class="w-5 h-5 border-2 border-primary-600 border-t-transparent rounded-full animate-spin"></div>
            <span class="font-medium">Generating personalized questions...</span>
          </div>
        </div>

      </form>
    </div>
  </div>
</div>

<script>
// =============== SKILL TAG SYSTEM ===============
let skills = [];

const skillInput = document.getElementById("skillInput");
const skillTags = document.getElementById("skillTags");

skillInput.addEventListener("keydown", function (e) {
  if (e.key === "Enter") {
    e.preventDefault();
    const value = skillInput.value.trim();
    if (value && !skills.includes(value.toLowerCase())) {
      skills.push(value);
      renderSkillTags();
    }
    skillInput.value = "";
  }
});

function renderSkillTags() {
  skillTags.innerHTML = "";
  skills.forEach((skill, index) => {
    const tag = document.createElement("div");
    tag.className =
      "px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm font-medium flex items-center gap-2";

    tag.innerHTML = `
      <span>${skill}</span>
      <button onclick="removeSkill(${index})" class="hover:text-red-600 text-sm">✕</button>
    `;
    skillTags.appendChild(tag);
  });
}

window.removeSkill = function (index) {
  skills.splice(index, 1);
  renderSkillTags();
};

// =============== FORM SUBMIT ===============
document.getElementById("genForm").addEventListener("submit", async function (e) {
  e.preventDefault();

  const title = document.getElementById("title").value;
  const type = document.getElementById("type").value;
  const experienceLevel = document.getElementById("experienceLevel").value;
  const duration = parseInt(document.getElementById("duration").value);

  const genBtn = document.getElementById("genBtn");
  const loadingState = document.getElementById("loadingState");

  genBtn.disabled = true;
  genBtn.innerHTML = "Generating...";
  loadingState.classList.remove("hidden");

  try {
    const res = await fetch("/interview/generate", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        title,
        type,
        skills, // typed skills as array
        experienceLevel,
        duration,
      }),
    });

    if (!res.ok) throw new Error("Generation failed");

    window.location.href = "/dashboard";
  } catch (err) {
    alert("Failed to generate interview questions. Try again.");
    genBtn.disabled = false;
    genBtn.innerHTML = "Generate Interview Questions";
    loadingState.classList.add("hidden");
  }
});
</script>
